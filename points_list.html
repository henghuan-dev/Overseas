<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>海外ポイント一覧</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- 依存ライブラリ（Leaflet / Cluster / Flags） -->
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css">

  <!-- Globe用（three.js + globe.gl） -->
  <script defer src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script defer src="https://unpkg.com/globe.gl@^2.32.0/dist/globe.gl.min.js"></script>

  <!-- サイトCSS（base統合後のlist.cssを使用） -->
  <link rel="stylesheet" href="css/list.css?v=0.1">

  <!-- Leaflet本体（グローバル） -->
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script defer src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <!-- ★ 追加：グラフ出し分け用の最小CSS -->
  <style>
    :root{
      --embed-h-pc: clamp(560px, 75vh, 900px); /* PC側の高さ */
      --embed-h-sp: 520px;                     /* SP側の高さ（適宜調整） */
      --surfline-h: clamp(420px, 60vh, 800px); /* Surfline 埋め込み高さ */
    }
    /* 出し分け用コンテナ */
    #chart-host{ width:100%; }
    /* PC用iframe（chart_iframe.html） */
    #chart-pc{ display:block; width:100%; height:var(--embed-h-pc); border:0; }
    /* SP用iframe（指定の mjof URL） */
    #chart-sp{ display:none;  width:100%; height:var(--embed-h-sp); border:0; }
    /* 768px以下をSP扱い */
    @media (max-width: 768px){
      #chart-pc{ display:none; }
      #chart-sp{ display:block; }
    }
    /* Surfline の埋め込みが0高にならないように */
    .surfline-pane .chart-iframe{
      width:100%;
      height:var(--surfline-h);
      border:0;
      display:block;
    }
  </style>
</head>

<body>
  <div class="page-wrap">

    <!-- ========== ヘッダー ========== -->
    <header class="page-head" aria-label="ページヘッダー">
      <div class="brand-logo">
        <a href="/" aria-label="ホーム">
          <img src="img/white.svg" alt="サイトロゴ" height="28">
        </a>
      </div>

      <!-- ▼ グローバル検索（国 / ポイント名） -->
      <form id="global-search" class="head-search" role="search" autocomplete="off">
        <input id="global-q" class="head-input" type="search"
              placeholder="国・ポイント名で検索"
              aria-label="国・ポイント名で検索"
              aria-controls="search-suggest"
              enterkeyhint="search" />
        <!-- 送信ボタン（モバイル向けにも見える） -->
        <button type="submit" class="head-btn" aria-label="検索">
          <!-- シンプルなルーペアイコン（SVG） -->
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 1 0-.71.71l.27.28v.79L20 21.5 21.5 20l-6-6zm-6 0a4.5 4.5 0 1 1 0-9 4.5 4.5 0 0 1 0 9z"/>
          </svg>
        </button>

        <div id="search-suggest" class="head-suggest" role="listbox" hidden></div>
      </form>

      <div class="point-name">海外ポイント</div>
    </header>

    <!-- ========== 広告バナー（任意） ========== -->
    <section class="banner-box" aria-label="広告バナー">
      <a href="#" target="_blank" rel="noopener">
        <img src="img/Lasik_1200x300-from2025-0519.jpg" alt="バナー" loading="lazy" decoding="async">
      </a>
    </section>

    <!-- 国名横スクロールバー -->
    <nav id="country-bar" class="country-bar">
      <div class="country-scroll" id="country-scroll">
        <!-- JSで動的に埋め込み -->
      </div>
    </nav>

    <!-- ===== ヒーロー 2カラム（左：Globe/Map切替 / 右：一覧 常時表示） ===== -->
    <section id="hero-2col" class="globe-hero" aria-label="世界マップとポイント一覧">
      <!-- 左：Globe/Map を同じ位置に重ねる（CSSで z-index 切替） -->
      <div class="hero-left left-switch" id="left-switch">
        <!-- Globe（初期表示） -->
        <div id="globe" class="globe-canvas" aria-label="3D地球儀キャンバス"></div>

        <!-- Map（初期は非表示。JSで .is-hidden を外して前面化） -->
        <div id="map" class="is-hidden" role="application" aria-label="サーフポイント地図"></div>

        <!-- 左ペインのオーバーレイ（Map時のみ「Globeに戻る」を表示） -->
        <div class="viewbar map-controls" aria-hidden="false">
          <span id="map-region-label" class="map-region-label" aria-live="polite"></span>
          <button
            type="button"
            id="back-to-globe-btn"
            class="back-pill"
            data-ui="back-to-globe"
          >🌍 Globeに戻る</button>
         </div>

        <!-- Globeヒント（Globe時のみ表示） -->
        <div class="globe-hint" aria-hidden="true">
          ドラッグで回転・ピンチ/ホイールでズーム・国旗クリックで地図へ
        </div>
      </div>

      <!-- 右：ポイント一覧（常時同じUI。結果だけJSで差し替え） -->
      <aside class="hero-right right-list pane" aria-labelledby="ttl-points">
        <div id="results" class="results" aria-live="polite"></div>
      </aside>
    </section>

    <!-- ========== もう一つのグラフ：PC=chart_iframe.html / SP=指定iframe ========== -->
    <section class="pane alt-chart-pane" aria-label="ポイント別チャート">
      <div id="chart-head" class="chart-head" aria-live="polite">
        <div class="chart-head-left">
          <span id="chart-flag" class="flag-icon" aria-hidden="true"></span>
          <h3 id="chart-title" class="chart-title">ポイント未選択</h3>
        </div>
        <div class="chart-head-actions">
          <button type="button" id="btn-graph" class="ch-btn" title="グラフへ">Graph</button>
          <button type="button" id="btn-guide" class="ch-btn" title="ガイドを表示">Guide</button>
        </div>
      </div>
      <div id="chart-host">
        <!-- PC側（同階層に chart_iframe.html がある前提。異なる場合はパスを調整） -->
        <iframe
          id="chart-pc"
          title="ポイントチャート（PC）"
          src="../chart_kitaizumi.html"
          loading="lazy"
          allowfullscreen
        ></iframe>

        <!-- SP側（指定URL） -->
        <iframe
          id="chart-sp"
          title="ポイントチャート（SP）"
          src="https://surfline.mjof.xyz/chart.html?&spotId=584204204e65fad6a7709981&paystatus=2"
          loading="lazy"
          referrerpolicy="no-referrer"
          allowfullscreen
        ></iframe>
      </div>
    </section>

    <!-- ========== Surflineチャート（現状維持） ========== -->
    <section class="pane surfline-pane" aria-labelledby="ttl-surfline">
      <div id="surfline-chart">
        <iframe
          class="chart-iframe"
          src="https://www.surfline.com/embed/surf-charts/Ishikawa/58581a836630e24c448790fe/@28.293,140.120,3.47z?type=wave-height&client_id=6123ef4f5192b46d74d575a6&days=16"
          loading="lazy"
          allowfullscreen
        ></iframe>
      </div>
    </section>
    <div id="guide-modal" hidden style="position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.4);z-index:9999;">
      <div style="max-width:720px;width:clamp(300px,90vw,720px);background:var(--panel,#0f141b);border:1px solid var(--line,#1e2630);border-radius:12px;">
        <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line,#1e2630);">
          <strong id="guide-title">Guide</strong>
          <button type="button" id="guide-close" class="ch-btn">閉じる</button>
        </div>
        <div id="guide-body" style="padding:14px; max-height:60vh; overflow:auto; line-height:1.6;"></div>
      </div>
    </div>

    <!-- ========== アドセンス枠（箱だけ用意） ========== -->
    <section class="adsense-box" id="adsense" aria-label="広告枠">
      <!-- 後で AdSense タグを挿入 -->
    </section>

  </div><!-- /.page-wrap -->

  <!-- （任意）幅をまたいだ切替時は、状態をきれいにするためにリロード -->
  <script>
    const mql = window.matchMedia('(max-width: 768px)');
    mql.addEventListener?.('change', () => location.reload());
  </script>

  <!-- アプリJS（points_list 用） -->
  <script type="module" src="js/list.js?v=0.1"></script>
</body>
</html>
